/*! ngSelect
version: 0.0.1
build date: 2013-07-20
author: Robin Fan
https://github.com/pc035860/ngSelect.git */
angular.module("ngSelect",[]).controller("ngSelectCtrl",["$scope","$parse",function(a,b){function c(a,b){var c,d=a.length;for(c=0;d>c;c++)if(a[c].value==b)return c;return-1}function d(a){return!isNaN(parseFloat(a))&&isFinite(a)}function e(){var a;if(f.multiple){var b=!1;a=h.getModel(),angular.isArray(a)?a.length=0:(b=!0,a=[]),angular.forEach(j,function(b){b.selected&&a.push(b.value)}),b&&h.setModel(a)}else{a=null;var c,d,e;for(c=0,d=j.length;d>c;c++)if(e=j[c],e.selected){a=e.value;break}h.setModel(a)}}var f,g,h=this,i=0,j=[];h.EVENT_INIT="ngSelect:init",h.init=function(c){if(angular.isUndefined(c.model))throw new Error("ngSelect model is required");c=angular.extend({multiple:!1},c),f=angular.copy(c),g=b(c.model);var d=h.getModel();angular.isUndefined(d)&&h.setModel(f.multiple?[]:null),a.$broadcast(h.EVENT_INIT,[f.model])},h.getConfig=function(){return f},h.updateOption=function(a,b){a.value=d(b)?Number(b):b,e()},h.addOption=function(a){var b={index:i++,value:d(a)?Number(a):a,selected:!1};return j.push(b),b},h.select=function(a){a.selected=!0,f.multiple||angular.forEach(j,function(b){b.index!==a.index&&(b.selected=!1)}),e()},h.unselect=function(a){f.multiple&&(a.selected=!1,e())},h.clear=function(){if(f.multiple){var a=h.getModel();angular.isArray(a)?a.length=0:h.setModel([])}else h.setModel(null)},h.setModel=function(b){var c=g.assign;c(a,b)},h.getModel=function(){return g(a)},h.render=function(){if(!angular.isUndefined(f))if(f.multiple){for(var a,b,d=angular.copy(h.getModel()),e=angular.extend([],j),g=d.length;g--;)a=d.shift(),b=e.splice(c(e,a),1)[0],b&&(b.selected=!0);angular.forEach(e,function(a){a.selected=!1})}else{var i=!1;angular.forEach(j,function(a){i||a.value!=h.getModel()?a.selected=!1:(a.selected=!0,i=!0)})}}}]).directive("ngSelect",["$parse","$timeout",function(a,b){return{restrict:"A",controller:"ngSelectCtrl",link:function(a,c,d,e){var f={};f.multiple=function(){return angular.isUndefined(d.selectMultiple)?!1:""===d.selectMultiple||1===Number(d.selectMultiple)}(),f.model=d.ngSelect,f.classExpr=d.selectClass,f.disabledExpr=d.selectDisabled,f.styleExpr=d.selectStyle,b(function(){e.init(f)}),a.$watch(d.ngSelect,function(a,b){angular.isDefined(a)&&a!==b&&e.render()},!0)}}}]).directive("ngSelectOption",[function(){return{restrict:"A",require:"^ngSelect",link:function(a,b,c,d){function e(a){l=c.selectClass||a.classExpr,k=c.disabledExpr||a.disabledExpr,m=c.selectStyle||a.styleExpr}function f(a){var b={};return angular.forEach(a,function(a,c){b["$"+c]=a}),b}function g(b,c){return a.$eval(b,f(c))}function h(a,c){c&&a!==c&&angular.forEach(c,function(a,c){b.css(c,"")}),a&&b.css(a)}function i(a,c){var d=function(a,b){var c=[];return angular.forEach(a,function(a,d){var e=b(a,d);e&&c.push(e)}),c},e=function(a){angular.isObject(a)&&!angular.isArray(a)&&(a=d(a,function(a,b){return a?b:void 0})),b.removeClass(angular.isArray(a)?a.join(" "):a)},f=function(a){angular.isObject(a)&&!angular.isArray(a)&&(a=d(a,function(a,b){return a?b:void 0})),a&&b.addClass(angular.isArray(a)?a.join(" "):a)};c&&!angular.equals(a,c)&&e(c),f(a)}var j,k,l,m;a.$on(d.EVENT_INIT,function(a,b){var c=d.getConfig();angular.isDefined(c)&&c.model===b[0]&&e(c)}),c.$observe("ngSelectOption",function(c,e){angular.isDefined(c)&&c!==e&&(angular.isUndefined(j)?(j=d.addOption(c),b.bind("click",function(){return k&&g(k,j)||a.$apply(function(){d[j.selected?"unselect":"select"](j)}),!1}),a.$watch(function(a){return a.$eval(l,f(j))},i,!0),a.$watch(function(a){return a.$eval(m,f(j))},h,!0)):d.updateOption(j,c))})}}}]);